/*! jquery-stone - v0.0.0 - 2012-07-03
* https://github.com/roothybrid7/jquery-stone
* Copyright (c) 2012 Satoshi Ohki; Licensed MIT, GPLv2 */
(function(a,b,c){function h(b){this.options=a.extend({},f,b),this._defaults=f,this._name=d,this._buffer={},this.init()}"use strict";var d="stone",e="0.0.0",f={dataScheme:"jqstone",enableEngines:[],saveStrategy:"fallback",syncBufferLimit:0},g={};h.prototype={init:function(){var a=this.options.enableEngines[0];this.database=g[a]},get:function(b,c){var d=a.extend({},c),e=this.getDataUrl(b),f=null;return e in this._buffer?f=this._buffer[e]:f=this.database.get(e,d),f&&(f.timestamp&&f.timestamp<Date.now()?(this.database.remove(e),delete this._buffer[e]):this._buffer[e]=f),a.isPlainObject(f)?f.value:null},set:function(b,c,d){var e=a.extend({},d),f=this.getDataUrl(b),g=e.expires,h={value:typeof c=="undefined"?null:c};if(g instanceof Date)h.timestamp=g.getTime();else if(typeof g=="number"){var i=new Date;i.setTime(i.getTime()+g),h.timestamp=i.getTime()}return this.database.set(f,h,e),this._buffer[f]=h,this},remove:function(a,b){var c=this.getDataUrl(a);return this.database.remove(c,b),delete this._buffer[c],this},clear:function(){return this.database.clear(new RegExp(this.getDataUrl(""))),this._buffer={},this},getDataUrl:function(a){var b=this.options.dataScheme;return b?b+"://"+a:a}},a[d]={_version:function(){return e},_defaults:function(){return f},availableEngines:function(){return g},unregisterStorageEngine:function(a){delete g[a]},registerStorageEngine:function(a,b){b.isAvailable()&&(g[a]=b)},create:function(a){return new h(a)}}})(jQuery,this),function(a,b,c){"use strict";var d="stone",e={};e.JsonFormat={extension:function(){return"json"},mimeType:function(){return"application/json"},encode:function(a,b){return typeof a=="undefined"||a===null?null:typeof a=="object"||typeof a=="string"?JSON.stringify.apply(JSON,arguments):a},decode:function(a,b){var c=null;try{c=JSON.parse.apply(JSON,arguments)}catch(d){c=null}return c}},a.extend(a[d],e)}(jQuery,this),function(a,b,c){"use strict";var d="stone",e={};e.URIFormat={extension:function(){return null},mimeType:function(){return"text/html"},encode:function(a){return typeof a=="undefined"||a===null?"":encodeURIComponent(a)},decode:function(a){return decodeURIComponent(a)}},a.extend(a[d],e)}(jQuery,this),function(a,b,c){"use strict";var d="stone",e=a[d];e.registerStorageEngine("cookie",{isAvailable:function(){return"cookie"in document},_setCookie:function(a,b,c){return document.cookie=[encodeURIComponent(a),"=",c.raw?b:encodeURIComponent(b),c.expires?"; expires="+c.expires:"",c.path?"; path="+c.path:"",c.domain?"; domain="+c.domain:"",c.secure?"; secure":""].join("")},set:function(b,c,d){var e=a.extend({},d),f=c.value,g=c.timestamp;if(typeof c=="undefined"||c===null)e.expires=-1;return g&&(e.expires=(new Date(g)).toUTCString()),this._setCookie(b,c,e)},get:function(b,c){var d=a.extend({},c),e=new RegExp("(?:^|; )"+encodeURIComponent(b)+"=([^;]*)"),f=e.exec(document.cookie);if(f){var g=d.raw?f[1]:decodeURIComponent(f[1]);if(g==="null")g=null;else if(g==="true"||g==="false")g=Boolean(g);return g}return null},remove:function(b,c){var d=a.extend({},c);d.expires=-1,this._setCookie(b,null,d)},clear:function(a){var b=document.cookie.split("; "),c=b.length;for(var d=0;d<c;d++){var e=b[d].split("=")[0];a?e.match(a)&&this.remove(e):this.remove(keyValue[0])}}})}(jQuery,this),function(a,b,c){"use strict";var d="stone",e=a[d];e.registerStorageEngine("localStorage",{isAvailable:function(){try{return"localStorage"in window&&window.localStorage!==null}catch(a){return!1}},set:function(a,b,c){var d=e.JsonFormat.encode(b);localStorage.setItem(a,d)},get:function(b,c){var d=a.extend({},c),f=localStorage.getItem(b);return f?d.raw?f:e.JsonFormat.decode(f):null},remove:function(a,b){localStorage.removeItem(a)},clear:function(a){if(a)for(var b=0,c=localStorage.length;b<c;b++){var d=localStorage.key(b);d&&d.match(a)&&localStorage.removeItem(d)}else localStorage.clear()}})}(jQuery,this);